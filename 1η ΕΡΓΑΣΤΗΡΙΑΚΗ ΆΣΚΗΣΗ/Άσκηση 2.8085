NOP          ;********
IN 10H       ;********

LXI B,0064H       ;εισαγωγή του αριθμού 100D=64H (δηλαδή 0,1sec) όπως ζητάει η άσκηση για την χρονοκαθυστέριση DELB
MVI A,0DH         ;ενεργοποίηση των διακοπών και της INTRPT 
SIM             
EI            

LXI H,0BF0H	     ;Αρχικοποίηση του τμήματος μνήμης που
MVI M,00H	     ;χρησιμοποιείται από τη ρουτίνα DCD
INX H                     
MVI M,10H	     ;θέλουμε να εμφανίζεται συνεχώς στο δεξιότερο 7-segment display
INX H
MVI M,10H
INX H
MVI M,10H
INX H
MVI M,10H
INX H
MVI M,10H
                   ;για την εμφάνιση του μετρητή στα MSB των LEDs
MVI A,00H          ;αρχικοποίηση του μερτητή Α με την αρχική τιμή 0   
LOOP1:
CMA                ;η έξοδος είναι αρνητικής λογικής
STA 3000H          ;εμφάνιση του μετρητή Α
CMA                ;συμπλήρωση του Α αφού έχει αλλάξει λόγω της εμφάνισης στην STA 
CALL DCD           ;καλλούμε την ρουτίνα DCD ώστε να εμφανίσει στο display
CALL DELB          ;καλλούμε την χρονοκαθυστέρηση DELB για να γίνουν ευδιάκριτες οι αλλαγές στα LEDs
ADI 10H            ;όταν φτάσει στην 00010000 τότε προσθέτουμε 10Η ώστε να μην ανοίξουν τα LSB
JMP LOOP1          ;συνεχής μέτρηση

INTR_ROUTINE:      ;ορισμός ρουτίνας διακοπής
PUSH PSW           ;push των σημαιών και του Α
LDA 0800H ;****    ;εδω έχουμε την περίπτωση για το κλικ (πάτημα και άφημα) να λαμβάνεται 
CPI 00H   ;****    ;ως μία διακοπή. αυτό το κάνουμε θεωρόντας ότι η τιμή της μνήμης 0800H 
JNZ CONT  ;****    ;παίρνει τις τιμές 00H όπου και μετράμε την διακοπή και την τιμή FFH όπου απιρρίπτει την διακοπή
LDA 2000H          ;Φορτωσε την εισοδο
RRC                ;Ειναι το πρώτο LSB OFF?
JNC CONT           ;Αν ναι τότε πηγαινε στην ετικέτα CONT ώστε να μην μετρήσει η διακοπή

LDA 0BF0H          ;η τιμή της θέσης μνήμης που περιέχει την ένδειξη του δεξιότερου 7-segmaet display	
INR A              ;αυξάνεται κατά ένα ώστε να εμφανιστελι στο display
ANI 0FH            ;όταν φτάσει στον αριθμό 0FH τότε θέλουμε να μετρήσει από την αρχή
STA 0BF0H          ;αποθήκευση στην θέση μνήμης που βρίσκεται η ένδειξη του αριστερότερου 7-segment diaplay
CONT:
LDA 0800H ;****    ;συμπληρώνεται η τιμή της θέσης μνήμης 0800Η που ελέγχει αν η διακοπή θα προσμετρηθεί
CMA       ;****
STA 0800H ;****    
POP PSW            ;επαναφορά των σημαιών και του Α όπως ήταν πριν την εισαγωγή στην ρουτίνα διακοπής
EI                 ;ενεργοποίηση των διακοπών αφού απενεργοποιούνται κατά την εισαγωγή στην ρουτίνα διακοπής
RET                ;επιστροφή στη πρόγραμμα

END
